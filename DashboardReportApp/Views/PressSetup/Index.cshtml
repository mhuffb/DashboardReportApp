@{
    ViewData["Title"] = "Press Setup";
    var operators = ViewData["Operators"] as List<string>;
    var machines = ViewData["Machines"] as List<string>;
    var trainers = ViewData["Trainers"] as List<string>;
    var activeLogins = ViewData["ActiveLogins"] as List<dynamic>;
}

<div class="container mt-4">
    <h1 class="text-center mb-4">Press Setup</h1>

    @if (ViewData["Message"] != null)
    {
        <div class="alert alert-success fade show" role="alert">
            @ViewData["Message"]
        </div>
    }

    @if (ViewData["Error"] != null)
    {
        <div class="alert alert-danger fade show" role="alert">
            @ViewData["Error"]
        </div>
    }

    <div class="card shadow mb-4">
        <div class="card-body">
            <h2 class="text-center">Login</h2>
            <form method="post" action="/PressSetup/Login">
                <div class="mb-3">
                    <label for="partNumber" class="form-label">Part Number</label>
                    <input type="text" id="partNumber" name="partNumber" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="operatorName" class="form-label">Operator</label>
                    <select id="operatorName" name="operatorName" class="form-control" required>
                        <option value="">-- Select Operator --</option>
                        @foreach (var op in operators)
                        {
                            <option value="@op">@op</option>
                        }
                    </select>
                </div>
                <div class="mb-3">
                    <label for="machine" class="form-label">Machine</label>
                    <select id="machine" name="machine" class="form-control" required>
                        <option value="">-- Select Machine --</option>
                        @foreach (var machine in machines)
                        {
                            <option value="@machine">@machine</option>
                        }
                    </select>
                </div>
                <button type="submit" class="btn btn-primary w-100">Login</button>
            </form>
        </div>
    </div>

    <h2 class="text-center mb-4">Active Logins</h2>

    <div class="table-responsive">
        <table class="table table-striped table-bordered shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Part</th>
                    <th>Operator</th>
                    <th>Machine</th>
                    <th>Start Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var login in activeLogins)
                {
                    <tr>
                        <td>@login.Part</td>
                        <td>@login.Operator</td>
                        <td>@login.Machine</td>
                        <td>@login.StartDateTime</td>
                        <td>
                            <form method="post" action="/PressSetup/Logout" class="p-3">
                                <input type="hidden" name="partNumber" value="@login.Part" />
                                <input type="hidden" name="startDateTime" value="@login.StartDateTime" />

                                <div class="mb-3">
                                    <label for="difficulty" class="form-label">Difficulty</label>
                                    <select name="difficulty" class="form-control" required>
                                        <option value="">-- Select Difficulty --</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="assistanceRequired" class="form-label">Assistance Required</label>
                                    <select name="assistanceRequired" class="form-control assistance-required" data-assisted-by="assistedByField-@login.Part" required>
                                        <option value="">-- Select Assistance --</option>
                                        <option value="Solo">Solo</option>
                                        <option value="Assisted">Assisted</option>
                                    </select>
                                </div>

                                <div class="mb-3 assisted-by-field d-none" id="assistedByField-@login.Part">
                                    <label for="assistedBy" class="form-label">Assisted By</label>
                                    <select name="assistedBy" class="form-control">
                                        <option value="">-- Select Trainer --</option>
                                        @foreach (var trainer in trainers)
                                        {
                                            <option value="@trainer">@trainer</option>
                                        }
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="setupComplete" class="form-label">Setup Complete</label>
                                    <select name="setupComplete" class="form-control" required>
                                        <option value="">-- Select Setup Status --</option>
                                        <option value="Yes">Yes</option>
                                        <option value="No">No</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="notes" class="form-label">Notes</label>
                                    <textarea name="notes" class="form-control text-area-large"></textarea>
                                </div>

                                <button type="submit" class="btn btn-danger w-100">Logout</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<style>
    .btn {
        transition: 0.3s ease-in-out;
    }

        .btn:hover {
            transform: scale(1.05);
        }

    .text-area-large {
        min-height: 150px !important;
    }

    .table-responsive {
        overflow-x: auto;
        display: block;
    }
</style>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const assistanceRequiredFields = document.querySelectorAll(".assistance-required");

        assistanceRequiredFields.forEach(field => {
            field.addEventListener("change", function () {
                const assistedByFieldId = this.dataset.assistedBy;
                const assistedByField = document.getElementById(assistedByFieldId);

                if (this.value === "Assisted") {
                    assistedByField.style.display = "block";
                } else {
                    assistedByField.style.display = "none";
                }
            });
        });
    });
</script>