@model List<DashboardReportApp.Models.PressSetupModel>

@{
    ViewData["Title"] = "Press Setup";
    var operators = ViewData["Operators"] as List<string> ?? new List<string>();
    var machines = ViewData["Machines"] as List<string> ?? new List<string>();
    var trainers = ViewData["Trainers"] as List<string> ?? new List<string>();
}

<div class="container mt-4">
    <h1 class="text-center mb-4">Press Setup</h1>

    @if (ViewData["Message"] != null)
    {
        <div class="alert alert-success fade show" role="alert">
            @ViewData["Message"]
        </div>
    }

    @if (ViewData["Error"] != null)
    {
        <div class="alert alert-danger fade show" role="alert">
            @ViewData["Error"]
        </div>
    }

    <!-- Login Form -->
    <div class="card shadow mb-4">
        <div class="card-body">
            <h2 class="text-center">Login</h2>
            <form method="post" asp-action="Login">
                <div class="mb-3">
                    <label for="partNumber" class="form-label">Part Number</label>
                    <input type="text" id="partNumber" name="partNumber" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="operatorName" class="form-label">Operator</label>
                    <select id="operatorName" name="operatorName" class="form-control" required>
                        <option value="">-- Select Operator --</option>
                        @foreach (var op in operators)
                        {
                            <option value="@op">@op</option>
                        }
                    </select>
                </div>
                <div class="mb-3">
                    <label for="machine" class="form-label">Machine</label>
                    <select id="machine" name="machine" class="form-control" required>
                        <option value="">-- Select Machine --</option>
                        @foreach (var machine in machines)
                        {
                            <option value="@machine">@machine</option>
                        }
                    </select>
                </div>
                <button type="submit" class="btn btn-primary w-100">Login</button>
            </form>
        </div>
    </div>

    <!-- Active Logins with Logout -->
    <h2 class="text-center mb-4">Active Logins</h2>

    <div class="table-responsive">
        <table class="table table-striped table-bordered shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Part</th>
                    <th>Operator</th>
                    <th>Machine</th>
                    <th>Start Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var login in Model.Where(x => x.EndDateTime == null))
                {
                    <tr>
                        <td>@login.Part</td>
                        <td>@login.Operator</td>
                        <td>@login.Machine</td>
                        <td>@(login.StartDateTime?.ToString("yyyy-MM-dd HH:mm") ?? "N/A")</td>
                        <td>
                            <form method="post" asp-action="Logout" class="p-3">
                                <input type="hidden" name="partNumber" value="@login.Part" />
                                <input type="hidden" name="startDateTime" value="@login.StartDateTime" />

                                <div class="mb-3">
                                    <label for="difficulty" class="form-label">Difficulty</label>
                                    <select name="difficulty" class="form-control" required>
                                        <option value="">-- Select Difficulty --</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="assistanceRequired" class="form-label">Assistance Required</label>
                                    <select name="assistanceRequired" class="form-control assistance-required" data-assisted-by="assistedByField-@login.Part" required>
                                        <option value="">-- Select Assistance --</option>
                                        <option value="Solo">Solo</option>
                                        <option value="Assisted">Assisted</option>
                                    </select>
                                </div>

                                <div class="mb-3 assisted-by-field d-none" id="assistedByField-@login.Part">
                                    <label for="assistedBy" class="form-label">Assisted By</label>
                                    <select name="assistedBy" class="form-control">
                                        <option value="">-- Select Trainer --</option>
                                        @foreach (var trainer in trainers)
                                        {
                                            <option value="@trainer">@trainer</option>
                                        }
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="setupComplete" class="form-label">Setup Complete</label>
                                    <select name="setupComplete" class="form-control" required>
                                        <option value="">-- Select Setup Status --</option>
                                        <option value="Yes">Yes</option>
                                        <option value="No">No</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="notes" class="form-label">Notes</label>
                                    <textarea name="notes" class="form-control text-area-large"></textarea>
                                </div>

                                <button type="submit" class="btn btn-danger w-100">Logout</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Full List of Records -->
    <h2 class="text-center mt-4">All Press Setup Records</h2>

    <div class="table-responsive">
        <table class="table table-striped table-bordered shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Timestamp</th>
                    <th>Part</th>
                    <th>Operator</th>
                    <th>Machine</th>
                    <th>Press Type</th>
                    <th>Difficulty</th>
                    <th>Setup Complete</th>
                    <th>Assistance Required</th>
                    <th>Assisted By</th>
                    <th>Start DateTime</th>
                    <th>End DateTime</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var record in Model)
                {
                    <tr>
                        <td>@record.Id</td>
                        <td>@(record.Timestamp?.ToString("yyyy-MM-dd HH:mm") ?? "N/A")</td>
                        <td>@record.Part</td>
                        <td>@record.Operator</td>
                        <td>@record.Machine</td>
                        <td>@record.PressType</td>
                        <td>@record.Difficulty</td>
                        <td>@record.SetupComp</td>
                        <td>@record.AssistanceReq</td>
                        <td>@record.AssistedBy</td>
                        <td>@(record.StartDateTime?.ToString("yyyy-MM-dd HH:mm") ?? "N/A")</td>
                        <td>@(record.EndDateTime?.ToString("yyyy-MM-dd HH:mm") ?? "N/A")</td>
                        <td>@record.Notes</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<style>
    .btn {
        transition: 0.3s ease-in-out;
    }

        .btn:hover {
            transform: scale(1.05);
        }

    .text-area-large {
        min-height: 150px !important;
    }

    .table-responsive {
        overflow-x: auto;
        display: block;
    }
</style>
