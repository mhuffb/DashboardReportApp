@model DashboardReportApp.Models.GroupDetailsViewModel


<h2>Tool Order @Model.GroupID Details</h2>

<!-- Display Existing Tool Items -->
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Tool Number</th>
            <th>Action</th>
            <th>ToolItem</th>
            <th>Tool Description</th>
            <th>Cost</th>
            <th>Revision</th>
            <th>Quantity</th>
            <th>Tool Work Hours</th>
            <th>Date Due</th>
            <th>Date Fitted</th>
            <th>Received By</th>
            <th>Fitted By</th>
            
        </tr>
    </thead>
    <tbody>
        @foreach (var tool in Model.ToolItems)
        {
            <tr>
                <td>@tool.ToolNumber</td>
                <td>@tool.Action</td>
                <td>@tool.ToolItem</td>
                <td>@tool.ToolDesc</td>
                <td>@tool.Cost</td>
                <td>@tool.Revision</td>
                <td>@tool.Quantity</td>
                <td>@tool.ToolWorkHours</td>
                <td>@tool.DateDue?.ToString("yyyy-MM-dd")</td>
                <td>@tool.DateFitted?.ToString("yyyy-MM-dd")</td>
                <td>@tool.ReceivedBy</td>
                <td>@tool.FittedBy</td>
                
            </tr>
        }
    </tbody>
</table>

<!-- Form to Add/Edit Tool Items -->
<h3>Add/Edit Tool Item</h3>
<form asp-action="AddOrEditToolItem" method="post">
    <!-- GroupID as a hidden field -->
    <input type="hidden" asp-for="NewToolItem.GroupID" />

    <div class="form-group">
        <label>Tool Number</label>
        <input asp-for="NewToolItem.ToolNumber" class="form-control" />
    </div>
    <!-- Action field with known options + "Other" -->
    <div class="form-group">
        <label>Action</label>
        <select id="actionSelect" class="form-control">
            <option value="">-- Select Action --</option>
            <option value="Make New">Make New</option>
            <option value="Metalife Coat">Metalife Coat</option>
            <option value="Tinalox Coat">Tinalox Coat</option>
            <option value="Reface">Reface</option>
            <option value="Fitting">Fitting</option>
            <option value="Other">Other</option>
        </select>
        <!-- Text box for custom action (hidden by default) -->
        <input id="actionOther" type="text" class="form-control mt-1" placeholder="Enter custom action"
               style="display: none;" />
        <!-- Hidden field bound to your model property -->
        <input asp-for="NewToolItem.Action" type="hidden" id="actionHidden" />
    </div>

    <!-- ToolItem field with known options + "Other" -->
    <div class="form-group">
        <label>Tool Item</label>
        <select id="toolItemSelect" class="form-control">
            <option value="">-- Select Tool Item --</option>
            <option value="Top Punch">Top Punch</option>
            <option value="Bottom Punch">Bottom Punch</option>
            <option value="Top Outer Punch">Top Outer Punch</option>
            <option value="Bottom Outer Punch">Bottom Outer Punch</option>
            <option value="Top Inner Punch">Top Inner Punch</option>
            <option value="Bottom Inner Punch">Bottom Inner Punch</option>
            <option value="Punch Holder">Punch Holder</option>
            <option value="Molding Pin">Molding Pin</option>
            <option value="Molding Pin Ext.">Molding Pin Ext.</option>
            <option value="Molding Die">Molding Die</option>
            <option value="Complete Set">Complete Set</option>
            <option value="Other">Other</option>
        </select>
        <!-- Text box for custom tool item (hidden by default) -->
        <input id="toolItemOther" type="text" class="form-control mt-1" placeholder="Enter custom tool item"
               style="display: none;" />
        <!-- Hidden field bound to your model property -->
        <input asp-for="NewToolItem.ToolItem" type="hidden" id="toolItemHidden" />
    </div>

    <div class="form-group">
        <label>Tool Description</label>
        <input asp-for="NewToolItem.ToolDesc" class="form-control" />
    </div>
    <div class="form-group">
        <label>Cost</label>
        <input asp-for="NewToolItem.Cost" type="number" step="0.01" class="form-control" />
    </div>
    <div class="form-group">
        <label>Revision</label>
        <input asp-for="NewToolItem.Revision" class="form-control" />
    </div>
    <div class="form-group">
        <label>Quantity</label>
        <input asp-for="NewToolItem.Quantity" type="number" class="form-control" />
    </div>
    <div class="form-group">
        <label>Tool Work Hours</label>
        <input asp-for="NewToolItem.ToolWorkHours" type="number" class="form-control" />
    </div>
    <div class="form-group">
        <label>Date Due</label>
        <input asp-for="NewToolItem.DateDue" type="date" class="form-control" />
    </div>
    <div class="form-group">
        <label>Date Fitted</label>
        <input asp-for="NewToolItem.DateFitted" type="date" class="form-control" />
    </div>
    <div class="form-group">
        <label>Received By</label>
        <input asp-for="NewToolItem.ReceivedBy" class="form-control" />
    </div>
    <div class="form-group">
        <label>Fitted By</label>
        <input asp-for="NewToolItem.FittedBy" class="form-control" />
    </div>
    

    <button type="submit" class="btn btn-success">Save</button>
</form>
@section Scripts {
    <script>
        const actionSelect = document.getElementById('actionSelect');
        const actionOther = document.getElementById('actionOther');
        const actionHidden = document.getElementById('actionHidden');

        const toolItemSelect = document.getElementById('toolItemSelect');
        const toolItemOther = document.getElementById('toolItemOther');
        const toolItemHidden = document.getElementById('toolItemHidden');

        // Show/hide text box if "Other" is chosen in Action
        actionSelect.addEventListener('change', function () {
            if (this.value === 'Other') {
                actionOther.style.display = 'block';
            } else {
                actionOther.style.display = 'none';
            }
        });

        // Show/hide text box if "Other" is chosen in ToolItem
        toolItemSelect.addEventListener('change', function () {
            if (this.value === 'Other') {
                toolItemOther.style.display = 'block';
            } else {
                toolItemOther.style.display = 'none';
            }
        });

        // On form submit, if "Other" is selected, override hidden field
        const form = document.querySelector('form[asp-action="AddOrEditToolItem"]');
        form.addEventListener('submit', function (event) {
            // Action
            if (actionSelect.value === 'Other') {
                actionHidden.value = actionOther.value;
            } else {
                actionHidden.value = actionSelect.value;
            }

            // ToolItem
            if (toolItemSelect.value === 'Other') {
                toolItemHidden.value = toolItemOther.value;
            } else {
                toolItemHidden.value = toolItemSelect.value;
            }
        });
    </script>
}

