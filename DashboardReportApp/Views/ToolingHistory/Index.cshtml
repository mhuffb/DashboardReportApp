@model DashboardReportApp.Models.ToolingHistory

<h2>Tooling History</h2>

<!-- Form for Adding a New Tooling History -->
<div class="mb-4">
    <h3>Add New Tool Order</h3>
    <form asp-action="Index" method="post">
        <div class="form-group">
            <label>Assembly #</label>
            <input asp-for="Part" class="form-control" />
        </div>
        <div class="form-group">
            <label>Tool Number</label>
            <input asp-for="ToolNumber" class="form-control" />
        </div>
        <div class="form-group">
            <label>Revision</label>
            <input asp-for="Revision" class="form-control" />
        </div>
        <div class="form-group">
            <label>PO</label>
            <input asp-for="PO" class="form-control" />
        </div>
        <div class="form-group">
            <label>Reason</label>
            <select asp-for="Reason" class="form-control">
                <option value="">-- Select Reason --</option>
                <option value="New">New (5030)</option>
                <option value="Repair">Repair (5045)</option>
                <option value="Breakage">Breakage (5040)</option>
                <option value="Fitting">Fitting</option>
            </select>
            <span asp-validation-for="Reason" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label>Tool Vendor</label>
            <select asp-for="ToolVendor" class="form-control">
                <option value="">-- Select Tool Vendor --</option>
                <option value="J.I.T. Tool & Die">J.I.T. Tool & Die</option>
                <option value="Gerg Tool & Die Inc.">Gerg Tool & Die Inc.</option>
                <option value="Quala Die">Quala Die</option>
                <option value="Internal">Internal</option>
            </select>
        </div>

        <div class="form-group">
            <label>Date Initiated</label>
            <input asp-for="DateInitiated" type="date" class="form-control" />
        </div>
        <div class="form-group">
            <label>Date Due</label>
            <input asp-for="DateDue" type="date" class="form-control" />
        </div>
        
        
        <div class="form-group">
            <label>Cost</label>
            <input asp-for="Cost" type="number" step="0.01" class="form-control" />
        </div>
        
        
        <div class="form-group">
            <label>Tool Work Hours</label>
            <input asp-for="ToolWorkHours" type="number" class="form-control" />
        </div>
        <div class="form-group">
            <label>Tool Desc</label>
            <textarea asp-for="ToolDesc" class="form-control"></textarea>
        </div>
        <button type="submit" class="btn btn-success">Add</button>
    </form>
</div>

<hr />

<!-- Table for Displaying Existing Tooling History Records -->
<div>
    <h3>Existing Tooling Orders</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Tool Order</th>
                <th>Assembly #</th>
                <th>Tool Number</th>
                <th>Revision</th>
                <th>PO</th>
                <th>Reason</th>
                <th>Tool Vendor</th>
                <th>Date Initiated</th>
                <th>Date Due</th>
                <th>Cost</th>
                <th>Tool Work Hours</th>
                <th>Tool Desc</th>
            </tr>
        </thead>
        <tbody>
            @if (ViewBag.ToolingHistories != null)
            {
                foreach (var item in ViewBag.ToolingHistories)
                {
                    <tr>
                        <td>@item.GroupID</td>
                        <td>@item.Part</td>
                        <td>@item.ToolNumber</td>
                        <td>@item.Revision</td>
                        <td>@item.PO</td>
                        <td>
                            @{
                                // Translate the reason to an accounting code
                                int? code = item.Reason switch
                                {
                                    "New" => 5030,
                                    "Repair" => 5045,
                                    "Breakage" => 5040,
                                    "Fitting" => null, // or whatever code you want
                                    _ => null
                                };
                            }

                            @item.Reason
                            @if (code.HasValue)
                            {
                                <text> (@code)</text>
                            }
                        </td>
                        <td>@item.ToolVendor</td>
                        <td>@item.DateInitiated.ToString("yyyy-MM-dd")</td>
                        <td>@item.DateDue?.ToString("yyyy-MM-dd")</td>
                        <td>@item.Cost</td>
                        <td>@item.ToolWorkHours</td>
                        <td>@item.ToolDesc</td>
                        <td>
                            <a asp-action="GroupDetails" asp-route-groupID="@item.GroupID" class="btn btn-primary">Add Tool Items</a>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation-unobtrusive@3.2.12/dist/jquery.validate.unobtrusive.min.js"></script>
}
